<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
    <link rel="stylesheet" href="css/auth.css">
</head>
<body>
<div class="auth-container">
    <!-- Gradient Panel -->
    <div class="auth-panel gradient">
        <h2>Reset Your Password</h2>
        <p>Please enter a new password for your account</p>
    </div>

    <!-- Right Panel -->
    <div class="auth-panel form-panel">
        <h2>Create New Password</h2>
        <form id="resetForm">
            <input type="password" id="newPassword" placeholder="New Password" required />
            <button id="resetSubmit" type="submit">Reset Password</button>
        </form>
        <p id="resetMessage" class="message-box" style="display:none;" aria-live="polite"></p>
        <p class="small-text">
            <a href="login.html" class="forgot-link">Back to Log in</a>
        </p>
    </div>
</div>

<script src="js/config.js"></script>
<script src="js/utils.js"></script>
<script>
    // Extract token from URL
    const params = new URLSearchParams(window.location.search);
    const token = params.get("token");
    const msg = document.getElementById("resetMessage");

    document.getElementById("resetForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const newPassword = document.getElementById("newPassword").value;
        const submit = document.getElementById('resetSubmit');

        if (!token) {
            UI.showMessage(msg, "❌ Missing or invalid token.", "error");
            return;
        }

        try {
            UI.setBusy(submit, true);
            await API.http(`/api/auth/reset-password?token=${encodeURIComponent(token)}&newPassword=${encodeURIComponent(newPassword)}`, {
                method: "POST"
            });
            UI.showMessage(msg, "✅ Password reset successful! You can now login.", "success");
        } catch (err) {
            UI.showMessage(msg, err.message || "❌ Reset failed.", "error");
        } finally {
            UI.setBusy(submit, false);
        }
    });
</script>
</body>
</html>
