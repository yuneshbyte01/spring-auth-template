<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reset Password</title>
    <link rel="stylesheet" href="/css/auth.css">
</head>
<body>
<div class="auth-container">
    <!-- Gradient Panel -->
    <div class="auth-panel gradient">
        <h2>Reset Your Password</h2>
        <p>Please enter a new password for your account</p>
    </div>

    <!-- Right Panel -->
    <div class="auth-panel form-panel">
        <h2>Create New Password</h2>
        <form id="resetForm">
            <input type="password" id="newPassword" placeholder="New Password" required />
            <button type="submit">Reset Password</button>
        </form>
        <p id="resetMessage" class="message-box" style="display:none;"></p>
        <p class="small-text">
            <a href="login.html" class="forgot-link">Back to Log in</a>
        </p>
    </div>
</div>

<script>
    // Extract token from URL
    const params = new URLSearchParams(window.location.search);
    const token = params.get("token");
    const msg = document.getElementById("resetMessage");

    document.getElementById("resetForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const newPassword = document.getElementById("newPassword").value;

        try {
            const res = await fetch(`http://localhost:8080/api/auth/reset-password?token=${token}&newPassword=${newPassword}`, {
                method: "POST"
            });

            msg.style.display = "block";
            if (res.ok) {
                msg.textContent = "✅ Password reset successful! You can now login.";
                msg.className = "message-box success";
            } else {
                const errorText = await res.text();
                msg.textContent = errorText || "❌ Reset failed.";
                msg.className = "message-box error";
            }
        } catch (err) {
            msg.style.display = "block";
            msg.textContent = "❌ Something went wrong.";
            msg.className = "message-box error";
        }
    });
</script>
</body>
</html>
